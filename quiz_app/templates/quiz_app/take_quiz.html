{% extends 'quiz_app/base.html' %}
{% load static %}

{% block title %}{{ quiz.title }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow mt-4">

            <!-- Header -->
            <div class="card-header bg-primary text-white text-center">
                <h3 class="mb-1">{{ quiz.title }}</h3>
                <p class="mb-1">{{ quiz.description }}</p>
                <h5>
                    ⏱ Time Remaining:
                    <span id="timer" class="fw-bold"></span>
                </h5>
            </div>

            <!-- Body -->
            <div class="card-body">
                <form method="post" id="quizForm">
                    {% csrf_token %}

                    {% for question in questions %}
                        <div class="mb-4">
                            <p class="fw-bold">
                                {{ forloop.counter }}. {{ question.text }}
                            </p>

                            <div class="form-check">
                                <input class="form-check-input"
                                       type="radio"
                                       name="{{ question.id }}"
                                       value="1"
                                       id="{{ question.id }}_1">
                                <label class="form-check-label" for="{{ question.id }}_1">
                                    {{ question.option1 }}
                                </label>
                            </div>

                            <div class="form-check">
                                <input class="form-check-input"
                                       type="radio"
                                       name="{{ question.id }}"
                                       value="2"
                                       id="{{ question.id }}_2">
                                <label class="form-check-label" for="{{ question.id }}_2">
                                    {{ question.option2 }}
                                </label>
                            </div>

                            <div class="form-check">
                                <input class="form-check-input"
                                       type="radio"
                                       name="{{ question.id }}"
                                       value="3"
                                       id="{{ question.id }}_3">
                                <label class="form-check-label" for="{{ question.id }}_3">
                                    {{ question.option3 }}
                                </label>
                            </div>

                            <div class="form-check">
                                <input class="form-check-input"
                                       type="radio"
                                       name="{{ question.id }}"
                                       value="4"
                                       id="{{ question.id }}_4">
                                <label class="form-check-label" for="{{ question.id }}_4">
                                    {{ question.option4 }}
                                </label>
                            </div>
                        </div>
                        <hr>
                    {% endfor %}

                    <div class="text-center">
                        <button type="submit" class="btn btn-success px-5">
                            Submit Quiz
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function startTimer(duration, formId) {
    let timer = duration;
    const display = document.getElementById("timer");
    const form = document.getElementById(formId);

    const interval = setInterval(function () {
        let minutes = Math.floor(timer / 60);
        let seconds = timer % 60;

        display.textContent =
            minutes + ":" + (seconds < 10 ? "0" : "") + seconds;

        if (--timer < 0) {
            clearInterval(interval);
            alert("⏰ Time is up! Submitting quiz.");
            form.submit();
        }
    }, 1000);
}

// ✅ FIX HERE
const quizTime = Number("{{ quiz.time_limit|default:10 }}");
startTimer(quizTime * 60, "quizForm");
</script>

{% endblock %}
